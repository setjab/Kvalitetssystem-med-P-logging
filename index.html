<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <title>Kvalitetssystem ‚Äì Ungdom</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#f4f6f9; color:#222; }

    /* P√•loggingsvindu */
    #loginScreen {
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      background: linear-gradient(135deg, #14532d, #228B22, #b8860b);
    }
    #loginBox {
      background:#fff;
      padding:40px;
      border-radius:12px;
      box-shadow:0 6px 20px rgba(0,0,0,0.3);
      text-align:center;
      width:320px;
    }
    #loginBox h2 {
      margin-bottom:20px;
      color:#14532d;
    }
    #loginBox input {
      width:90%;
      padding:10px;
      margin:8px 0;
      border:1px solid #ccc;
      border-radius:6px;
      font-size:16px;
    }
    #loginBox button {
      margin-top:14px;
      padding:10px 20px;
      width:95%;
      background:#228B22;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:16px;
      font-weight:bold;
    }
    #loginBox button:hover {
      background:#14532d;
    }
    #errorMsg {
      color:#e53935;
      margin-top:10px;
      font-size:14px;
    }

    /* App (skjules f√∏r innlogging) */
    #appContainer { display:none; padding:20px; }

    header {
      background: linear-gradient(90deg, #14532d, #228B22, #b8860b);
      color: #fff;
      padding: 36px 20px;
      text-align: center;
      font-size: 34px;
      font-weight: 900;
      border-radius: 14px;
      margin-bottom: 25px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.25);
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    header span {
      display:block;
      font-size:22px;
      font-weight:600;
      margin-top:10px;
      text-transform:none;
    }

    .question { background:#fff; padding:12px; margin-bottom:10px; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,.08); }
    .answer-btn { margin:6px 6px 6px 0; padding:10px 14px; border:none; border-radius:6px; cursor:pointer; opacity:.9; }
    .answer-btn.selected { outline:3px solid #000; opacity:1; }
    .answer-ja { background:#28a745; color:#fff; }
    .answer-nei { background:#dc3545; color:#fff; }
    .answer-usikker { background:#ffc107; color:#111; }
    .save-btn { padding:10px 14px; background:#0b7; color:#fff; border:none; border-radius:6px; cursor:pointer; margin-top:10px; }
    .export-btn { padding:10px 14px; background:#189; color:#fff; border:none; border-radius:6px; cursor:pointer; margin-top:10px; margin-right:8px; }
    #userList { margin-top:12px; background:#fff; padding:10px; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,.06); }
    .block-summary { margin-top:12px; padding:12px; background:#f8f9ff; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,.06); }
    .block-row { display:flex; align-items:center; margin-bottom:12px; }
    .block-row canvas { width:100px !important; height:100px !important; margin-right:14px; }
    footer { margin-top:18px; font-size:13px; color:#666; text-align:center; }
  </style>
</head>
<body>

<!-- Login -->
<div id="loginScreen">
  <div id="loginBox">
    <h2>üîë Logg inn</h2>
    <input type="text" id="loginUser" placeholder="Brukernavn" />
    <input type="password" id="loginPass" placeholder="Passord" />
    <button onclick="checkLogin()">Logg inn</button>
    <div id="errorMsg"></div>
  </div>
</div>

<!-- App -->
<div id="appContainer">
<header>‚≠ê KVALITETSSYSTEM ‚Äì UNGDOM ‚≠ê<br>
<span>‚úÖ Utviklet av Settar Al-Jabri ‚úÖ</span></header>

<h2>Registrering</h2>
<label>Brukernavn / ID
  <input type="text" id="username" placeholder="Skriv navn eller ID" />
</label>

<div id="questions"></div>
<button class="save-btn" onclick="saveData()">üíæ Lagre svar</button>

<div id="userList"></div>
<hr/>

<div id="dashboard">
  <h3>Dashboard ‚Äì samlet (alle brukere)</h3>
  <canvas id="resultChart" width="600" height="300"></canvas>
  <div id="allSummary" class="block-summary"></div>
</div>

<div style="margin-top:12px;">
  <button class="export-btn" onclick="exportCSV()">‚¨á Last ned CSV</button>
  <button class="export-btn" onclick="exportPDF()">üìÑ Last ned PDF</button>
  <button class="export-btn" onclick="exportJSON()">üóÇÔ∏è Last ned JSON</button>
  <label class="export-btn" style="cursor:pointer;">
    üì§ Last opp JSON
    <input type="file" id="jsonFileInput" accept=".json" style="display:none" onchange="importJSON(event)" />
  </label>
</div>

<footer>Utviklet av Settar Al-Jabri</footer>
</div>

<script>
/* === Login-funksjon === */
function checkLogin(){
  const u=document.getElementById("loginUser").value;
  const p=document.getElementById("loginPass").value;
  if(u==="navland" && p==="2025"){
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("appContainer").style.display="block";
  } else {
    document.getElementById("errorMsg").innerText="‚ùå Feil brukernavn eller passord";
  }
}

/* === Sp√∏rsm√•l (36 stk) === */
const questions=[ /* ... samme som du hadde ... */ 
"Har du blitt tilstrekkelig kjent med personen for √• forst√• behovet for oppf√∏lging fremover?",
"Hvis brukeren har oppgitt hindringer eller behov for hjelp og veiledning, har du hatt en samtale?",
"Har samtalen handlet om brukerens jobbmuligheter?",
"Hvordan er kvaliteten i oppf√∏lgingsvedtaket?",
"‚Äî Inneholder begrunnelsen vurdering av brukerens √∏nsker, ressurser og forutsetninger?",
"‚Äî Inneholder begrunnelsen vurdering av personens jobbmuligheter (n√• eller p√• sikt)?",
"‚Äî Inneholder begrunnelsen vurdering av personens muligheter opp mot bransjer og/eller yrker?",
"‚Äî Inneholder begrunnelsen vurdering av hvilken hjelp og st√∏tte som trengs?",
"Er det en tydelig arbeidsretting i samhandlingen med brukeren?",
"‚Äî Har personen f√•tt veiledning knyttet til jobbm√•l?",
"‚Äî Har arbeid og aktivitet v√¶rt sentrale tema i dialogen?",
"‚Äî Har brukeren arbeidsrettede aktiviteter i planen sin?",
"‚Äî Har det v√¶rt tydelige avtalte oppf√∏lgingspunkter?",
"Har du vurdert hvilken hjelp og st√∏tte som kan bidra til jobb?",
"‚Äî Har du vurdert tilrettelegging p√• arbeidsplassen?",
"‚Äî Har du vurdert kvalifisering/oppl√¶ring?",
"‚Äî Har du vurdert samarbeid med andre enheter?",
"Har det v√¶rt samhandling med arbeidsgiver(e)?",
"‚Äî Er arbeidsgiver en del av oppf√∏lgingen?",
"‚Äî Har du vurdert l√∏nnstilskudd/mentor?",
"Har oppf√∏lgingen blitt evaluert underveis?",
"‚Äî Har aktivitetene blitt evaluert sammen med brukeren?",
"‚Äî Har m√•l/situasjon endret seg og nytt vedtak blitt fattet?",
"Har brukerm√∏tene v√¶rt planlagte?",
"‚Äî Er m√∏teagenda delt med brukeren?",
"‚Äî Brukes aktivitetsplanen i oppf√∏lgingen?",
"‚Äî Har du vurdert digital oppf√∏lging?",
"‚Äî Inneholder referater tydelige avtaler?",
"Har brukeren f√•tt medvirke i samarbeidet?",
"‚Äî Blir √∏nsker og behov ivaretatt?",
"‚Äî Har brukeren f√•tt informasjon om m√•let?",
"‚Äî Er det gjennomf√∏rt fysiske m√∏ter?",
"‚Äî Har brukeren medvirket i valg av tiltak?",
"Har den unge f√•tt informasjon om ungdomsgarantien?",
"Har den unge hatt brudd i oppf√∏lgingen?",
"Er det jobbet med √• gi den unge m√•lrettede aktiviteter?"];

/* === Blokker === */
const blocks={
  "Bli kjent og forst√• behov":Array.from({length:8},(_,i)=>i),
  "Arbeidsretting og fremdrift":Array.from({length:15},(_,i)=>i+8),
  "Brukermedvirkning":Array.from({length:10},(_,i)=>i+23),
  "Ungdomsgaranti (U30)":Array.from({length:3},(_,i)=>i+33)
};

let answers=[]; let allAnswers=[]; let resultChart=null; let blockCharts={};

function renderQuestions(){const div=document.getElementById('questions');div.innerHTML='';
  questions.forEach((q,i)=>{div.innerHTML+=`<div class="question" id="q${i}"><strong>${i+1}. ${q}</strong><br>
  <button class="answer-btn answer-ja" onclick="selectAnswer(${i},'Ja',this)">Ja</button>
  <button class="answer-btn answer-nei" onclick="selectAnswer(${i},'Nei',this)">Nei</button>
  <button class="answer-btn answer-usikker" onclick="selectAnswer(${i},'Usikker',this)">Usikker</button></div>`;});}
function selectAnswer(i,val,btn){answers[i]=val;document.querySelectorAll(`#q${i} .answer-btn`).forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');}
function saveData(){const username=document.getElementById('username').value||'Ukjent';const userAnswers=questions.map((q,i)=>({question:q,answer:answers[i]||''}));
  allAnswers.push({user:username,answers:userAnswers,timestamp:new Date().toISOString()});renderUserList();renderChartAndBlocks();
  answers=[];renderQuestions();document.getElementById('username').value='';}
function renderUserList(){let html='<strong>Lagrede brukere:</strong><ul>';for(let i=allAnswers.length-1;i>=0;i--){html+=`<li>${allAnswers[i].user}</li>`;}html+='</ul>';document.getElementById('userList').innerHTML=html;}
function renderEmptyDashboard(){const ctx=document.getElementById('resultChart').getContext('2d');
  resultChart=new Chart(ctx,{type:'bar',data:{labels:['Ja','Nei','Usikker'],datasets:[{data:[0,0,0],backgroundColor:['#28a745','#dc3545','#ffc107']}]},options:{responsive:false}});
  document.getElementById('allSummary').innerHTML='<em>Ingen data</em>';}
function renderChartAndBlocks(){const counts={Ja:0,Nei:0,Usikker:0};
  allAnswers.forEach(u=>u.answers.forEach(a=>{if(a.answer)counts[a.answer]++;}));
  const ctx=document.getElementById('resultChart').getContext('2d');
  if(resultChart) resultChart.destroy();
  resultChart=new Chart(ctx,{type:'bar',data:{labels:['Ja','Nei','Usikker'],datasets:[{data:[counts.Ja,counts.Nei,counts.Usikker],backgroundColor:['#28a745','#dc3545','#ffc107']}]},options:{responsive:false}});
  let html='<h4>Oppsummering per blokk (alle brukere)</h4>';
  for(const [block,idxs] of Object.entries(blocks)){let ja=0,nei=0,usikker=0;
    allAnswers.forEach(u=>{idxs.forEach(i=>{if(u.answers[i].answer==='Ja')ja++;if(u.answers[i].answer==='Nei')nei++;if(u.answers[i].answer==='Usikker')usikker++;});});
    const total=ja+nei+usikker;const canvasId="pie_"+block.replace(/\s+/g,'_');
    html+=`<div class="block-row"><canvas id="${canvasId}"></canvas><div><b>${block}:</b> Totalt ${total} (Ja:${ja}, Nei:${nei}, Usikker:${usikker})</div></div>`;
    setTimeout(()=>{const ctx=document.getElementById(canvasId).getContext("2d");if(blockCharts[canvasId]) blockCharts[canvasId].destroy();
      blockCharts[canvasId]=new Chart(ctx,{type:'doughnut',data:{labels:["Ja","Nei","Usikker"],datasets:[{data:[ja,nei,usikker],backgroundColor:['#4caf50','#e53935','#fbc02d']}]},options:{plugins:{legend:{display:false}},cutout:'50%'}});},50);}
  document.getElementById('allSummary').innerHTML=html;}
function exportCSV(){let csv="Bruker,Sp√∏rsm√•l,Svar\n";allAnswers.forEach(u=>u.answers.forEach(a=>{csv+=`${u.user},"${a.question}",${a.answer}\n`;}));
  const blob=new Blob([csv],{type:"text/csv"});const link=document.createElement("a");link.href=URL.createObjectURL(blob);link.download="resultater.csv";link.click();}
async function exportPDF(){const {jsPDF}=window.jspdf;const element=document.getElementById("dashboard");const canvas=await html2canvas(element,{scale:3});
  const imgData=canvas.toDataURL("image/png");const pdf=new jsPDF("p","mm","a4");const marginLeft=20;const pdfWidth=pdf.internal.pageSize.getWidth()-marginLeft;
  const pdfHeight=(canvas.height*pdfWidth)/canvas.width;pdf.addImage(imgData,"PNG",marginLeft,10,pdfWidth,pdfHeight);pdf.save("resultater.pdf");}
function exportJSON(){const blob=new Blob([JSON.stringify(allAnswers,null,2)],{type:"application/json"});const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);link.download="resultater.json";link.click();}
function importJSON(event){const file=event.target.files[0];if(!file) return;const reader=new FileReader();reader.onload=e=>{try{const data=JSON.parse(e.target.result);
  if(Array.isArray(data)){allAnswers=data;renderUserList();renderChartAndBlocks();alert("JSON-data lastet inn ‚úÖ");}else{alert("Ugyldig JSON-format ‚ùå");}}
  catch(err){alert("Feil ved lesing av JSON: "+err);}};reader.readAsText(file);}
renderQuestions();renderEmptyDashboard();
</script>
</body>
</html>
